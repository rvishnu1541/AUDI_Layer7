<?xml version="1.0" encoding="UTF-8"?>
<con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Authenticate TestCase" searchProperties="true" id="206dbc7b-6c1e-417c-b835-3fd623e9c432" xmlns:con="http://eviware.com/soapui/config"><con:settings><con:setting id="1394625d-c32e-48f5-82d4-f114817c612dfileName">Authenticate-TestCase</con:setting><con:setting id="206dbc7b-6c1e-417c-b835-3fd623e9c432fileName">Authenticate-TestCase</con:setting></con:settings><con:testStep type="datasource" name="DataSource" id="c4d08621-b4c5-4b0d-bceb-0b5bd84292b5"><con:settings/><con:config xsi:type="con:DataSourceStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:dataSource type="Excel"><con:configuration><file>D:/TestData/AUDI_US_Layer7_TestData.xlsx</file><worksheet>AUDI_TestData</worksheet><cell>A2</cell><ignoreEmpty>true</ignoreEmpty></con:configuration></con:dataSource><con:preload>false</con:preload><con:property>AccountId</con:property><con:property>PIN</con:property><con:property>VIN</con:property><con:property>TCUID</con:property><con:property>UserId</con:property><con:property>api_key</con:property><con:startRow/><con:endRow/><con:gotoLoopOnEmpty>false</con:gotoLoopOnEmpty><con:trimValues>false</con:trimValues><con:entitizeValues>false</con:entitizeValues><con:restartOnRun>true</con:restartOnRun><con:expandProperties>false</con:expandProperties></con:config></con:testStep><con:testStep type="jdbc" name="JDBC Request" id="6bbfce69-2b33-4b8e-bbf9-03fac0f1cb0a" disabled="true"><con:settings/><con:config xsi:type="con:JdbcRequestTestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:dbConnectionName xsi:nil="true"/><con:properties/></con:config></con:testStep><con:testStep type="request" name="Authenticate" id="6b7af202-6102-40a9-a049-10dd449bbd77"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>AuthorizationServiceAUDIUSV5_2PortBinding</con:interface><con:operation>Authenticate</con:operation><con:request name="Authenticate" id="895559fc-6da8-4e67-a7d7-5ba3ac1d5475" defaultOutgoingWss="" defaultIncomingWss=""><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>https://${#Project#ServiceEndPoint}/SOAP/AUDIUS_AuthorizationServiceV5_2</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:aud="http://xmlns.vzt.com/APIGateway/AUDIUS_AuthorizationServiceV5_2">
<soapenv:Header> 
 <api_key>${DataSource#api_key}</api_key> 
  <wsse:Security soapenv:mustUnderstand="1" wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd" xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd"> 
   <wsse:UsernameToken> 
     <wsse:Username>${DataSource#AccountId}</wsse:Username> 
     <wsse:Password Type="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText">${DataSource#PIN}</wsse:Password> 
   </wsse:UsernameToken> 
  </wsse:Security> 
</soapenv:Header>
  <soapenv:Body>
      <aud:Authenticate>
         <AuthenticateRequestType>
            <Data>
               <SourceName>WEB</SourceName>
               <ExternalUserName>Vishnu333</ExternalUserName>
               <ExternalUserID>Vishnu333</ExternalUserID>                                      
               <Email>john.smith@gmail.com</Email>
               <TraceID>Vishnu252622</TraceID>
               <TraceTimestamp>2015-03-04T22:14:02.001Z</TraceTimestamp>
            </Data>
         </AuthenticateRequestType>
      </aud:Authenticate>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="XPath Match" id="42e3af79-0a6c-465e-8e97-0897bea1e382" name="XPath Match"><con:configuration><path>declare namespace vwus='http://xmlns.vzt.com/APIGateway/AUDIUS_AuthorizationServiceV5_2';
//vwus:AuthenticateResponse[1]/Response[1]/ResponseCode[1]</path><content>2000</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match" id="42dc48fe-85dc-4a05-92aa-06014c2da4c3" name="XPath Match 2"><con:configuration><path>declare namespace vwus='http://xmlns.vzt.com/APIGateway/AUDIUS_AuthorizationServiceV5_2';
//vwus:AuthenticateResponse[1]/Response[1]/ResponseStatus[1]</path><content>Success</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:assertion type="XPath Match" id="9f3c3b9f-774a-4332-895f-91d0b0bdf2ca" name="XPath Match 3"><con:configuration><path>declare namespace vwus='http://xmlns.vzt.com/APIGateway/AUDIUS_AuthorizationServiceV5_2';
//vwus:AuthenticateResponse[1]/Response[1]/ResponseDescription[1]</path><content>Successful Execution</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:environmentSpec><con:entry environmentId="b56e681a-c44d-4881-95c6-fd3e3223d2a2"><con:authProfile>No Authorization</con:authProfile></con:entry><con:entry environmentId="3801e45a-ec31-4686-9cbf-01651b8a4315"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="6b0cf27d-4452-476c-b08b-8662a8c7e039"><con:authProfile>Inherit From Parent</con:authProfile></con:entry></con:environmentSpec><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig action="Authenticate" mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/></con:request></con:config></con:testStep><con:testStep type="transfer" name="Property Transfer" id="d14382bc-02af-4c05-8a9f-6032be7cbd60" disabled="true"><con:settings/><con:config xsi:type="con:PropertyTransfersStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:transfers setNullOnMissingSource="false" transferTextContent="false" failOnError="false" ignoreEmpty="false" transferToAll="false" entitize="false" transferChildNodes="true" disabled="false"><con:name>SessionToken</con:name><con:sourceType>Response</con:sourceType><con:sourceStep>Authenticate</con:sourceStep><con:sourcePath>declare namespace wsse='http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd';
//wsse:Security[1]</con:sourcePath><con:targetType>SessionToken</con:targetType><con:targetStep>#Project#</con:targetStep><con:targetPath/><con:targetTransferType>XPATH</con:targetTransferType><con:upgraded>true</con:upgraded></con:transfers></con:config></con:testStep><con:testStep type="groovy" name="Groovy Script" id="2e69ee06-8fc3-4176-bc07-b9e5d91b37dd"><con:settings/><con:config><script>def responsecontent=new String(testRunner.testCase.testSteps["Authenticate"].testRequest.response.rawResponseData)
def string = responsecontent
int startPosition = string.indexOf("&lt;soapenv:Header>") + "&lt;soapenv:Header>".length();
//log.info startPosition
int endPosition = string.indexOf("&lt;/soapenv:Header>",startPosition);
//log.info endPosition
String subS = string.substring(startPosition,endPosition );
log.info subS
testRunner.testCase.testSuite.project.setPropertyValue("SessionToken",subS)
</script></con:config></con:testStep><con:properties/><con:reportParameters/><con:breakPoints><con:testStepId>8564afb1-1f44-4ec7-a3e0-035188cb693c</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:environmentSpec><con:entry environmentId="3801e45a-ec31-4686-9cbf-01651b8a4315"><con:authProfile>Inherit From Parent</con:authProfile></con:entry><con:entry environmentId="6b0cf27d-4452-476c-b08b-8662a8c7e039"><con:authProfile>Inherit From Parent</con:authProfile></con:entry></con:environmentSpec></con:testCase>